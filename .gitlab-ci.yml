image:
  name: mikesupertrampster/packer

stages:
  - tag-source
  - build-base

tag-source:
  stage: tag-source
  only:
    changes:
      - ansible/**/*
    refs:
      - master
  script:
    - .scripts/git-changes.py
  artifacts:
    paths:
      - semver

build-base:
  stage: build-base
  variables:
    role: base
  only:
    changes:
      - ansible/roles/base/**/*
      - ansible/roles/hardening/**/*
    refs:
      - master
  script:
    - export VERSION_NO=$(cat semver)
    - packer build packer/${role}.json